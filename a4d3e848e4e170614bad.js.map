{"version":3,"sources":["webpack:///./node_modules/@ecomplus/widget-ebit/src/index.js"],"names":["options","ebitStoreId","router","window","storefrontApp","addConfirmationBanner","name","params","ecomPassport","fetchOrder","id","then","order","customer","getCustomer","ebitParam","amount","total","freight","number","_id","main_email","gender","toUpperCase","birth_date","day","month","year","padStart","items","length","skus","sku","values","getPrice","quantities","quantity","names","encodeURIComponent","i","shipping_lines","shippingLine","delivery_time","days","to","zip","transactions","transaction","installments","payment_method","code","credit_card","company","toLowerCase","tryAppendInterval","setInterval","$confirmation","document","getElementById","insertAdjacentHTML","clearInterval","catch","console","error","currentRoute","afterEach","Error"],"mappings":"2FAAA,4BAGe,WAACA,EAAU,MACxB,MAAM,YAAEC,GAAgBD,EACxB,GAAIC,EAAa,CACf,MAAMC,EAASC,OAAOC,eAAiBD,OAAOC,cAAcF,OAC5D,GAAIA,EAAQ,CACV,MAAMG,EAAwB,EAAGC,OAAMC,aACxB,iBAATD,GACFE,IAAaC,WAAWF,EAAOG,IAC5BC,KAAKC,IACJ,MAAMC,EAAWL,IAAaM,cAC9B,IAAIC,EAAY,kBAAWd,EAAX,wDACCW,EAAMI,OAAOC,OADd,uBAEGL,EAAMI,OAAOE,SAAW,GAF3B,yBAGKN,EAAMO,QAAUP,EAAMQ,KAH3B,iBAIJP,EAASQ,YAKrB,GAHIR,EAASS,SACXP,GAAa,WAAJ,OAAeF,EAASS,OAAOC,gBAEtCV,EAASW,WAAY,CACvB,MAAM,IAAEC,EAAF,MAAOC,EAAP,KAAcC,GAASd,EAASW,WACtCT,GAAa,aAAJ,OAAiBU,EAAIG,SAAS,EAAG,KAAjC,YAAyCF,EAAME,SAAS,EAAG,KAA3D,YAAmED,GAG9E,MAAM,MAAEE,GAAUjB,EAClB,GAAIiB,GAASA,EAAMC,OAAQ,CACzB,IAAIC,EAAOF,EAAM,GAAGG,IAChBC,EAASC,YAASL,EAAM,IACxBM,EAAaN,EAAM,GAAGO,SACtBC,EAAQC,mBAAmBT,EAAM,GAAGvB,MACxC,IAAK,IAAIiC,EAAI,EAAGA,EAAIV,EAAMC,OAAQS,IAChCR,GAAQ,IAAJ,OAAQF,EAAMU,GAAGP,KACrBC,GAAU,IAAJ,OAAQC,YAASL,EAAMU,KAC7BJ,GAAc,IAAJ,OAAQN,EAAMU,GAAGH,UAC3BC,GAAS,IAAJ,OAAQC,mBAAmBT,EAAMU,GAAGjC,OAE3CS,GAAa,QAAJ,OAAYgB,EAAZ,kBAA0BE,EAA1B,qBAA6CE,EAA7C,wBAAuEE,GAGlF,GAAIzB,EAAM4B,gBAAkB5B,EAAM4B,eAAe,GAAI,CACnD,MAAMC,EAAe7B,EAAM4B,eAAe,GAC1CzB,GAAa,wBAAkB0B,EAAaC,cAAcC,MAAQ,GAArD,mBACCF,EAAaG,GAAGC,KAGhC,GAAIjC,EAAMkC,cAAgBlC,EAAMkC,aAAa,GAAI,CAC/C,MAAMC,EAAcnC,EAAMkC,aAAa,GAGvC,OAFA/B,GAAa,YAAJ,OAAkBgC,EAAYC,cAAgBD,EAAYC,aAAa7B,QAAW,GAC3FJ,GAAa,gBACLgC,EAAYE,eAAeC,MACjC,IAAK,cACHnC,GAAa,KACb,MACF,IAAK,iBACHA,GAAa,KACb,MACF,IAAK,aACL,IAAK,eACL,IAAK,kBACHA,GAAa,KACb,MACF,IAAK,iBACHA,GAAa,KACb,MACF,QACEA,GAAa,KAGjB,GAAIgC,EAAYI,aAAeJ,EAAYI,YAAYC,QAErD,OADArC,GAAa,aACLgC,EAAYI,YAAYC,QAAQC,eACtC,IAAK,OACHtC,GAAa,EACb,MACF,IAAK,aACHA,GAAa,EACb,MACF,IAAK,mBACL,IAAK,OACHA,GAAa,EACb,MACF,IAAK,MACHA,GAAa,EACb,MACF,IAAK,OACHA,GAAa,EACb,MACF,IAAK,YACHA,GAAa,EACb,MACF,IAAK,cACHA,GAAa,EACb,MACF,QACEA,GAAa,GAKrB,MAkBMuC,EAAoBC,YAlBL,KACnB,MAAMC,EAAgBC,SAASC,eAAe,gBAC1CF,IACFA,EAAcG,mBACZ,YADF,oEAGmC5C,EAHnC,wQAQqEd,EARrE,mFAYA2D,cAAcN,KAGkC,OAErDO,MAAMC,QAAQC,QAIjB7D,EAAO8D,cACT3D,EAAsBH,EAAO8D,cAE/B9D,EAAO+D,UAAU5D,SAGnByD,QAAQC,MAAM,IAAIG,MAAM","file":"a4d3e848e4e170614bad.js","sourcesContent":["import { price as getPrice } from '@ecomplus/utils'\nimport ecomPassport from '@ecomplus/passport-client'\n\nexport default (options = {}) => {\n  const { ebitStoreId } = options\n  if (ebitStoreId) {\n    const router = window.storefrontApp && window.storefrontApp.router\n    if (router) {\n      const addConfirmationBanner = ({ name, params }) => {\n        if (name === 'confirmation') {\n          ecomPassport.fetchOrder(params.id)\n            .then(order => {\n              const customer = ecomPassport.getCustomer()\n              let ebitParam = `storeId=${ebitStoreId}&mktSaleId=0&platform=ecomplus` +\n                `&totalSpent=${order.amount.total}` +\n                `&deliveryTax=${(order.amount.freight || 0)}` +\n                `&transactionId=${(order.number || order._id)}` +\n                `&email=${customer.main_email}`\n\n              if (customer.gender) {\n                ebitParam += `&gender=${customer.gender.toUpperCase()}`\n              }\n              if (customer.birth_date) {\n                const { day, month, year } = customer.birth_date\n                ebitParam += `&birthday=${day.padStart(2, '0')}-${month.padStart(2, '0')}-${year}`\n              }\n\n              const { items } = order\n              if (items && items.length) {\n                let skus = items[0].sku\n                let values = getPrice(items[0])\n                let quantities = items[0].quantity\n                let names = encodeURIComponent(items[0].name)\n                for (let i = 1; i < items.length; i++) {\n                  skus += `|${items[i].sku}`\n                  values += `|${getPrice(items[i])}`\n                  quantities += `|${items[i].quantity}`\n                  names += `|${encodeURIComponent(items[i].name)}`\n                }\n                ebitParam += `&sku=${skus}&value=${values}&quantity=${quantities}&productName=${names}`\n              }\n\n              if (order.shipping_lines && order.shipping_lines[0]) {\n                const shippingLine = order.shipping_lines[0]\n                ebitParam += `&deliveryTime=${(shippingLine.delivery_time.days || 0)}` +\n                  `&zipCode=${shippingLine.to.zip}`\n              }\n\n              if (order.transactions && order.transactions[0]) {\n                const transaction = order.transactions[0]\n                ebitParam += `&parcels=${((transaction.installments && transaction.installments.number) || 1)}`\n                ebitParam += '&paymentType='\n                switch (transaction.payment_method.code) {\n                  case 'credit_card':\n                    ebitParam += '05'\n                    break\n                  case 'banking_billet':\n                    ebitParam += '08'\n                    break\n                  case 'debit_card':\n                  case 'online_debit':\n                  case 'account_deposit':\n                    ebitParam += '28'\n                    break\n                  case 'loyalty_points':\n                    ebitParam += '24'\n                    break\n                  default:\n                    ebitParam += '14'\n                }\n\n                if (transaction.credit_card && transaction.credit_card.company) {\n                  ebitParam += '&cardFlag='\n                  switch (transaction.credit_card.company.toLowerCase()) {\n                    case 'visa':\n                      ebitParam += 6\n                      break\n                    case 'mastercard':\n                      ebitParam += 5\n                      break\n                    case 'american express':\n                    case 'amex':\n                      ebitParam += 1\n                      break\n                    case 'elo':\n                      ebitParam += 8\n                      break\n                    case 'aura':\n                      ebitParam += 2\n                      break\n                    case 'hipercard':\n                      ebitParam += 4\n                      break\n                    case 'diners club':\n                      ebitParam += 3\n                      break\n                    default:\n                      ebitParam += 7\n                  }\n                }\n              }\n\n              const appendBanner = () => {\n                const $confirmation = document.getElementById('confirmation')\n                if ($confirmation) {\n                  $confirmation.insertAdjacentHTML(\n                    'beforeend',\n                    `<div>\n                      <param id=\"ebitParam\" value=\"${ebitParam}\">\n                      <a id=\"bannerEbit\"></a>\n                      <script\n                        type=\"text/javascript\"\n                        id=\"getSelo\"\n                        src=\"https://imgs.ebit.com.br/ebitBR/selo-ebit/js/getSelo.js?${ebitStoreId}&lightbox=true\"\n                      ></script>\n                    </div>`\n                  )\n                  clearInterval(tryAppendInterval)\n                }\n              }\n              const tryAppendInterval = setInterval(appendBanner, 200)\n            })\n            .catch(console.error)\n        }\n      }\n\n      if (router.currentRoute) {\n        addConfirmationBanner(router.currentRoute)\n      }\n      router.afterEach(addConfirmationBanner)\n    }\n  } else {\n    console.error(new Error('Can\\'t show lightbox without `ebitStoreId` option'))\n  }\n}\n"],"sourceRoot":""}